<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Facilitator</title>
<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
import { getDatabase, ref, set, update, onValue, onDisconnect } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js";

const firebaseConfig = {
  apiKey: "AIzaSyBjnfJOD8bK-PLKiFOYzC8Yz2S7g1hM1W0",
  authDomain: "rws-blackfog-game.firebaseapp.com",
  databaseURL: "https://rws-blackfog-game-default-rtdb.asia-southeast1.firebasedatabase.app",
  projectId: "rws-blackfog-game",
  storageBucket: "rws-blackfog-game.firebasestorage.app",
  messagingSenderId: "473543964029",
  appId: "1:473543964029:web:4bc0db33634ed2f8894814"
};

const app = initializeApp(firebaseConfig);
const db = getDatabase(app);

const session = new URLSearchParams(location.search).get("s") || "default";

document.getElementById("pushInject").onclick = () => {
  const text = document.getElementById("injectText").value;
  const ts = Date.now();
  set(ref(db, "sessions/" + session + "/latestInject"), { text, ts });
};

onValue(ref(db, "sessions/" + session + "/players"), snap => {
  const div = document.getElementById("players");
  div.innerHTML = "";
  snap.forEach(s => {
    const p = s.val();
    div.innerHTML += `<div>${p.name} - ${p.status}</div>`;
  });
});
</script>
</head>
<body>
<h2>Facilitator Panel</h2>
<div>
  <textarea id="injectText" placeholder="Inject text" style="width:300px;height:100px;"></textarea><br>
  <button id="pushInject">Send Inject</button>
</div>
<h3>Players Online</h3>
<div id="players"></div>
</body>
</html>
