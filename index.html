<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>RWS BlackFog â€“ Facilitator (Static v8.4.1)</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    :root {
      --bg: #020617;
      --panel: #020617;
      --panel2: #0b1120;
      --border: rgba(148, 163, 184, 0.55);
      --text: #e5e7eb;
      --muted: #9ca3af;
      --accent: #d72638;
      --accent-soft: rgba(215, 38, 56, 0.15);
    }
    * { box-sizing: border-box; }
    body {
      margin: 0;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      background: radial-gradient(circle at top, #111827 0, #020617 60%);
      color: var(--text);
    }
    header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 10px 16px;
      border-bottom: 1px solid var(--border);
      background: linear-gradient(180deg, rgba(0,0,0,0.95), rgba(15,23,42,0.85));
      backdrop-filter: blur(10px);
      position: sticky;
      top: 0;
      z-index: 10;
    }
    h1 {
      margin: 0;
      font-size: 18px;
    }
    .pill {
      display: inline-block;
      font-size: 12px;
      padding: 3px 8px;
      border-radius: 999px;
      border: 1px solid var(--border);
      background: rgba(15,23,42,0.9);
      margin-left: 8px;
    }
    .pill-live {
      border-color: var(--accent);
      color: var(--accent);
    }
    .container {
      max-width: 1200px;
      margin: 0 auto;
      padding: 14px;
    }
    .grid {
      display: grid;
      grid-template-columns: 2.1fr 1fr;
      gap: 16px;
      align-items: flex-start;
    }
    .card {
      background: var(--panel2);
      border-radius: 14px;
      border: 1px solid var(--border);
      padding: 12px 14px;
      box-shadow: 0 16px 42px rgba(0,0,0,0.6);
      margin-bottom: 14px;
    }
    .card-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 6px;
    }
    .card-header h2 {
      font-size: 15px;
      margin: 0;
    }
    .muted {
      font-size: 12px;
      color: var(--muted);
    }
    label {
      display: block;
      font-size: 12px;
      margin-bottom: 2px;
      color: var(--muted);
    }
    input, textarea, select {
      width: 100%;
      padding: 6px 8px;
      border-radius: 8px;
      border: 1px solid var(--border);
      background: #020617;
      color: var(--text);
      font-size: 13px;
    }
    textarea { resize: vertical; min-height: 60px; }
    .row { display: flex; gap: 8px; }
    .row > div { flex: 1; }
    .btn-bar {
      display: flex;
      gap: 6px;
      flex-wrap: wrap;
    }
    .btn {
      border-radius: 999px;
      border: 1px solid var(--border);
      background: rgba(15,23,42,0.9);
      color: var(--text);
      padding: 5px 10px;
      font-size: 12px;
      cursor: pointer;
      white-space: nowrap;
    }
    .btn-primary {
      border-color: var(--accent);
      background: var(--accent-soft);
    }
    .btn-danger {
      border-color: #f97373;
      color: #fecaca;
      background: rgba(127,29,29,0.4);
    }
    .btn:disabled { opacity: 0.45; cursor: default; }
    #timeline {
      border-radius: 10px;
      border: 1px solid var(--border);
      padding: 6px;
      background: #020617;
      max-height: 320px;
      overflow-y: auto;
      font-size: 12px;
    }
    .inj-row {
      display: grid;
      grid-template-columns: 44px 80px 1fr;
      gap: 6px;
      align-items: flex-start;
      padding: 4px 6px;
      border-radius: 8px;
    }
    .inj-row:nth-child(odd) { background: rgba(15,23,42,0.7); }
    .inj-row:nth-child(even) { background: rgba(15,23,42,0.45); }
    .inj-time { font-weight: 600; color: #eab308; }
    .inj-type { font-size: 11px; color: #bfdbfe; }
    .inj-text { white-space: pre-wrap; }
    .inj-dec { margin-top: 4px; font-size: 11px; color: var(--muted); }
    #log {
      font-size: 11px;
      max-height: 180px;
      overflow-y: auto;
      border-radius: 8px;
      border: 1px solid var(--border);
      padding: 4px 6px;
      background: #020617;
    }
    .log-line { margin: 0; padding: 2px 0; color: var(--muted); }
    #playersList {
      font-size: 12px;
      border-radius: 8px;
      border: 1px solid var(--border);
      padding: 4px 6px;
      background: #020617;
      max-height: 120px;
      overflow-y: auto;
    }
    .player-row { display: flex; justify-content: space-between; padding: 2px 0; }
    .player-name { font-weight: 500; }
    .player-status { font-size: 11px; color: var(--muted); }
    #aar {
      font-size: 12px;
      border-radius: 8px;
      border: 1px solid var(--border);
      padding: 4px 6px;
      background: #020617;
      max-height: 260px;
      overflow-y: auto;
    }
    table { border-collapse: collapse; width: 100%; font-size: 11px; }
    th, td { border: 1px solid #374151; padding: 4px; text-align: left; }
    th { background: #111827; }
    @media (max-width: 960px) { .grid { grid-template-columns: 1fr; } }
  </style>
</head>
<body data-role="facilitator">
<header>
  <div>
    <h1>RWS BlackFog â€“ Facilitator (Static)</h1>
    <span class="pill pill-live">LIVE SESSION <span id="sessionId"></span></span>
  </div>
  <div class="muted">Players: <span id="playersCount">0</span></div>
</header>

<div class="container">
  <div class="grid">
    <div>
      <section class="card">
        <div class="card-header">
          <h2>Scenario & Static Injects</h2>
          <span class="muted">Choose scenario â†’ publish once â†’ step injects linearly</span>
        </div>
        <div class="row" style="margin-bottom:6px;">
          <div>
            <label>Scenario preset</label>
            <select id="scenarioPreset">
              <option value="blackfog">Operation BlackFog â€“ Supply Chain</option>
              <option value="ransomware">Midweek Ransomware â€“ Finance</option>
              <option value="phishing">VIP Phishing & Account Takeover</option>
            </select>
          </div>
        </div>
        <div class="btn-bar" style="margin-bottom:6px;">
          <button id="btnLoadScenario" class="btn">ðŸ“¦ Load scenario into editor</button>
          <button id="btnPublishScenario" class="btn-primary">ðŸ“¡ Publish scenario to players</button>
          <button id="btnNextInject" class="btn-primary">âž¡ Next static inject</button>
          <button id="btnEndVoting" class="btn">ðŸ›‘ End voting (no decision)</button>
          <button id="btnEndExercise" class="btn-danger">â›” End exercise</button>
          <button id="btnNewSession" class="btn">âœ¨ Start new session</button>
        </div>
        <div>
          <label>Scenario title</label>
          <input id="scTitle" />
          <label style="margin-top:4px;">Scenario description</label>
          <textarea id="scDesc"></textarea>
        </div>
      </section>

      <section class="card">
        <div class="card-header">
          <h2>Inject Timeline (this session)</h2>
        </div>
        <div id="timeline"></div>
      </section>
    </div>

    <div>
      <section class="card">
        <div class="card-header"><h2>Connected Players</h2></div>
        <div id="playersList"></div>
      </section>

      <section class="card">
        <div class="card-header"><h2>Console log</h2></div>
        <div id="log"></div>
      </section>

      <section class="card">
        <div class="card-header">
          <h2>After Action â€“ Votes per inject</h2>
          <button id="btnBuildAAR" class="btn">ðŸ“Š Build AAR snapshot</button>
        </div>
        <div id="aar">
          <p class="muted">End an exercise, then build AAR to review A/B/C votes.</p>
        </div>
      </section>
    </div>
  </div>
</div>

<div id="voteOverlay" style="
  position:fixed;
  bottom:16px;
  right:16px;
  background:rgba(15,23,42,0.96);
  border:1px solid rgba(148,163,184,0.6);
  border-radius:10px;
  padding:10px 12px;
  font-size:12px;
  font-family:system-ui,-apple-system,BlinkMacSystemFont,'Segoe UI',sans-serif;
  color:#e5e7eb;
  min-width:240px;
  max-width:280px;
  box-shadow:0 12px 32px rgba(0,0,0,0.7);
  z-index:30;
  display:none;
">
  <div id="voteOverlayTitle" style="font-weight:600; margin-bottom:4px;">Voting status</div>
  <div id="voteOverlayBody" style="line-height:1.5;">Waiting for a decision injectâ€¦</div>
  <div id="voteOverlayBarWrap" style="margin-top:6px;">
    <div style="height:4px; border-radius:999px; background:#111827;">
      <div id="voteOverlayBar" style="height:4px; border-radius:999px; background:#22c55e; width:0%;"></div>
    </div>
    <div id="voteOverlayCount" style="margin-top:2px; font-size:11px; color:#9ca3af;">0 / 0 responses</div>
  </div>
</div>

<script type="module">
  import { initFacilitator } from "./engine_v8_4.js";
  initFacilitator();
</script>
</body>
</html>
