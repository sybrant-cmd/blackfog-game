<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Player</title>
<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
import { getDatabase, ref, set, update, onValue, onDisconnect } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js";

const firebaseConfig = {
  apiKey: "AIzaSyBjnfJOD8bK-PLKiFOYzC8Yz2S7g1hM1W0",
  authDomain: "rws-blackfog-game.firebaseapp.com",
  databaseURL: "https://rws-blackfog-game-default-rtdb.asia-southeast1.firebasedatabase.app",
  projectId: "rws-blackfog-game",
  storageBucket: "rws-blackfog-game.firebasestorage.app",
  messagingSenderId: "473543964029",
  appId: "1:473543964029:web:4bc0db33634ed2f8894814"
};

const app = initializeApp(firebaseConfig);
const db = getDatabase(app);

const session = new URLSearchParams(location.search).get("s") || "default";
const playerId = "p-" + Math.random().toString(36).slice(2,8);

set(ref(db, "sessions/" + session + "/players/" + playerId), {
  name: "Player-" + playerId,
  status: "online",
  ts: Date.now()
});

onDisconnect(ref(db, "sessions/" + session + "/players/" + playerId)).update({
  status: "offline",
  ts: Date.now()
});

setInterval(() => {
  update(ref(db, "sessions/" + session + "/players/" + playerId), {
    status: "online",
    ts: Date.now()
  });
}, 15000);

onValue(ref(db, "sessions/" + session + "/latestInject"), snap => {
  const inj = snap.val();
  if (!inj) return;
  document.getElementById("inject").textContent = inj.text;
});
</script>
</head>
<body>
<h2>Player View</h2>
<div id="inject">Waiting for facilitatorâ€¦</div>
</body>
</html>
